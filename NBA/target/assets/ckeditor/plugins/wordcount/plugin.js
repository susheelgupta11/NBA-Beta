CKEDITOR.plugins.add("wordcount",{lang:"ar,ca,da,de,el,en,es,fi,fr,he,hr,it,jp,nl,no,pl,pt,pt-br,ru,sv,tr,zh-cn",version:1.15,requires:"htmlwriter,notification,undo",init:function(e){function p(e){return"cke_wordcount_"+e.name}function d(e){return document.getElementById(p(e))}function v(e){var t=document.createElement("div");e=m(e);t.innerHTML=e;if(t.textContent==""&&typeof t.innerText=="undefined"){return""}return t.textContent||t.innerText}function m(e){if(l.filter instanceof CKEDITOR.htmlParser.filter){var t=CKEDITOR.htmlParser.fragment.fromHtml(e),n=new CKEDITOR.htmlParser.basicWriter;l.filter.applyTo(t);t.writeHtml(n);return n.getHtml()}return e}function g(t,n){if(l.countHTML){return m(t).length}else{var r;if(e.config.fullPage){var i=t.search(new RegExp("<body>","i"));if(i!=-1){var s=t.search(new RegExp("</body>","i"));t=t.substring(i+6,s)}}r=t;if(!l.countSpacesAsChars){r=t.replace(/\s/g,"").replace(/&nbsp;/g,"")}r=r.replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," ");r=v(r).replace(/^([\t\r\n]*)$/,"");return r.length}}function y(e){return e.replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/ig,"").replace(/^\s*$[\n\r]{1,}/gm,"++").split("++").length}function b(e){var t=e.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");t=v(t);var n=t.split(/\s+/);for(var r=n.length-1;r>=0;r--){if(n[r].match(/^([\s\t\r\n]*)$/)){n.splice(r,1)}}return n.length}function w(t,n){s=true;o=false;if(l.hardLimit){t.loadSnapshot(u);t.config.Locked=1}if(!n){d(t).className="cke_path_item cke_wordcountLimitReached";t.fire("limitReached",{},e)}}function E(t){o=true;s=false;t.config.Locked=0;u=e.getSnapshot();d(t).className="cke_path_item"}function S(e){var t=0,n=0,o=0,a;if(a=e.getData()){if(l.showCharCount){o=g(a,e)}if(l.showParagraphs){t=y(a)}if(l.showWordCount){n=b(a)}}var f=h.replace("%wordCount%",n).replace("%charCount%",o).replace("%paragraphs%",t);(e.config.wordcount||(e.config.wordcount={})).wordCount=n;(e.config.wordcount||(e.config.wordcount={})).charCount=o;if(CKEDITOR.env.gecko){d(e).innerHTML=f}else{d(e).innerText=f}if(o==i&&n==r){return true}var c=n-r;var p=o-i;r=n;i=o;if(r==-1){r=n}if(i==-1){i=o}if(l.maxWordCount>-1&&n>l.maxWordCount&&c>0||l.maxCharCount>-1&&o>l.maxCharCount&&p>0){w(e,s)}else if((l.maxWordCount==-1||n<l.maxWordCount)&&(l.maxCharCount==-1||o<l.maxCharCount)){E(e)}else{u=e.getSnapshot()}if(l.charCountGreaterThanMaxLengthEvent&&l.charCountLessThanMaxLengthEvent){if(o>l.maxCharCount&&l.maxCharCount>-1){l.charCountGreaterThanMaxLengthEvent(o,l.maxCharCount)}else{l.charCountLessThanMaxLengthEvent(o,l.maxCharCount)}}if(l.wordCountGreaterThanMaxLengthEvent&&l.wordCountLessThanMaxLengthEvent){if(n>l.maxWordCount&&l.maxWordCount>-1){l.wordCountGreaterThanMaxLengthEvent(n,l.maxWordCount)}else{l.wordCountLessThanMaxLengthEvent(n,l.maxWordCount)}}return true}var t="",n,r=-1,i=-1,s=false,o=false,u=e.getSnapshot();var a=function(e,t,n){if(typeof document.dispatchEvent=="undefined"){return}e="ckeditor.wordcount."+e;var r;var i={bubbles:false,cancelable:true,detail:{currentLength:t,maxLength:n}};try{r=new CustomEvent(e,i)}catch(s){r=document.createEvent("CustomEvent");r.initCustomEvent(e,i.bubbles,i.cancelable,i.detail)}document.dispatchEvent(r)};var f={showParagraphs:true,showWordCount:true,showCharCount:false,countSpacesAsChars:true,countHTML:false,hardLimit:true,maxWordCount:-1,maxCharCount:-1,filter:null,wordCountGreaterThanMaxLengthEvent:function(e,t){a("wordCountGreaterThanMaxLengthEvent",e,t)},charCountGreaterThanMaxLengthEvent:function(e,t){a("charCountGreaterThanMaxLengthEvent",e,t)},wordCountLessThanMaxLengthEvent:function(e,t){a("wordCountLessThanMaxLengthEvent",e,t)},charCountLessThanMaxLengthEvent:function(e,t){a("charCountLessThanMaxLengthEvent",e,t)}};var l=CKEDITOR.tools.extend(f,e.config.wordcount||{},true);if(l.showParagraphs){t+=e.lang.wordcount.Paragraphs+" %paragraphs%"}if(l.showParagraphs&&(l.showWordCount||l.showCharCount)){t+=", "}if(l.showWordCount){t+=e.lang.wordcount.WordCount+" %wordCount%";if(l.maxWordCount>-1){t+="/"+l.maxWordCount}}if(l.showCharCount&&l.showWordCount){t+=", "}if(l.showCharCount){var c=e.lang.wordcount[l.countHTML?"CharCountWithHTML":"CharCount"];t+=c+" %charCount%";if(l.maxCharCount>-1){t+="/"+l.maxCharCount}}var h=t;if(l.loadCss===undefined||l.loadCss){CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css")}e.on("key",function(t){if(e.mode==="source"){S(t.editor)}},e,null,100);e.on("change",function(e){S(e.editor)},e,null,100);e.on("uiSpace",function(t){if(e.elementMode===CKEDITOR.ELEMENT_MODE_INLINE){if(t.data.space=="top"){t.data.html+='<div class="cke_wordcount" style=""'+' title="'+e.lang.wordcount.title+'"'+'><span id="'+p(t.editor)+'" class="cke_path_item">&nbsp;</span></div>'}}else{if(t.data.space=="bottom"){t.data.html+='<div class="cke_wordcount" style=""'+' title="'+e.lang.wordcount.title+'"'+'><span id="'+p(t.editor)+'" class="cke_path_item">&nbsp;</span></div>'}}},e,null,100);e.on("dataReady",function(e){S(e.editor)},e,null,100);e.on("paste",function(e){if(l.maxWordCount>0||l.maxCharCount>0){var t=-1,n=-1,r=e.editor.getData()+e.data.dataValue;if(l.showCharCount){n=g(r,e.editor)}if(l.showWordCount){t=b(r)}var i=new CKEDITOR.plugins.notification(e.editor,{message:e.editor.lang.wordcount.pasteWarning,type:"warning"});if(l.maxCharCount>0&&n>l.maxCharCount&&l.hardLimit){i.show();e.cancel()}if(l.maxWordCount>0&&t>l.maxWordCount&&l.hardLimit){i.show();e.cancel()}}},e,null,100);e.on("afterPaste",function(e){S(e.editor)},e,null,100);e.on("blur",function(){if(n){window.clearInterval(n)}},e,null,300)}})