var Rico={Version:"1.1-beta2"};Rico.ArrayExtensions=new Array;if(Object.prototype.extend){Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Object.prototype.extend}if(Array.prototype.push){Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.push}if(!Array.prototype.remove){Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return false;for(var t=0,n=0;t<this.length;t++)if(t!=e)this[n++]=this[t];this.length-=1};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.remove}if(!Array.prototype.removeItem){Array.prototype.removeItem=function(e){for(var t=0;t<this.length;t++)if(this[t]==e){this.remove(t);break}};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.removeItem}if(!Array.prototype.indices){Array.prototype.indices=function(){var e=new Array;for(index in this){var t=false;for(var n=0;n<Rico.ArrayExtensions.length;n++){if(this[index]==Rico.ArrayExtensions[n]){t=true;break}}if(!t)e[e.length]=index}return e};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.indices}if(window.DOMParser&&window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__){if(!Document.prototype.loadXML){Document.prototype.loadXML=function(e){var t=(new DOMParser).parseFromString(e,"text/xml");while(this.hasChildNodes())this.removeChild(this.lastChild);for(var n=0;n<t.childNodes.length;n++){this.appendChild(this.importNode(t.childNodes[n],true))}}}Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)})}document.getElementsByTagAndClassName=function(e,t){if(e==null)e="*";var n=document.getElementsByTagName(e)||document.all;var r=new Array;if(t==null)return n;for(var i=0;i<n.length;i++){var s=n[i];var o=s.className.split(" ");for(var u=0;u<o.length;u++){if(o[u]==t){r.push(s);break}}}return r};Rico.Accordion=Class.create();Rico.Accordion.prototype={initialize:function(e,t){this.container=$(e);this.lastExpandedTab=null;this.accordionTabs=new Array;this.setOptions(t);this._attachBehaviors();this.container.style.borderBottom="1px solid "+this.options.borderColor;for(var n=1;n<this.accordionTabs.length;n++){this.accordionTabs[n].collapse();this.accordionTabs[n].content.style.display="none"}this.lastExpandedTab=this.accordionTabs[0];this.lastExpandedTab.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab.showExpanded();this.lastExpandedTab.titleBar.style.fontWeight=this.options.expandedFontWeight},setOptions:function(e){this.options={expandedBg:"#63699c",hoverBg:"#63699c",collapsedBg:"#6b79a5",expandedTextColor:"#ffffff",expandedFontWeight:"bold",hoverTextColor:"#ffffff",collapsedTextColor:"#ced7ef",collapsedFontWeight:"normal",hoverTextColor:"#ffffff",borderColor:"#1f669b",panelHeight:200,onHideTab:null,onShowTab:null}.extend(e||{})},showTabByIndex:function(e,t){var n=arguments.length==1?true:t;this.showTab(this.accordionTabs[e],n)},showTab:function(e,t){var n=arguments.length==1?true:t;if(this.options.onHideTab)this.options.onHideTab(this.lastExpandedTab);this.lastExpandedTab.showCollapsed();var r=this;var i=this.lastExpandedTab;this.lastExpandedTab.content.style.height=this.options.panelHeight-1+"px";e.content.style.display="";e.titleBar.style.fontWeight=this.options.expandedFontWeight;if(n){new Effect.AccordionSize(this.lastExpandedTab.content,e.content,1,this.options.panelHeight,100,10,{complete:function(){r.showTabDone(i)}});this.lastExpandedTab=e}else{this.lastExpandedTab.content.style.height="1px";e.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab=e;this.showTabDone(i)}},showTabDone:function(e){e.content.style.display="none";this.lastExpandedTab.showExpanded();if(this.options.onShowTab)this.options.onShowTab(this.lastExpandedTab)},_attachBehaviors:function(){var e=this._getDirectChildrenByTag(this.container,"DIV");for(var t=0;t<e.length;t++){var n=this._getDirectChildrenByTag(e[t],"DIV");if(n.length!=2)continue;var r=n[0];var i=n[1];this.accordionTabs.push(new Rico.Accordion.Tab(this,r,i))}},_getDirectChildrenByTag:function(e,t){var n=new Array;var r=e.childNodes;for(var i=0;i<r.length;i++)if(r[i]&&r[i].tagName&&r[i].tagName==t)n.push(r[i]);return n}};Rico.Accordion.Tab=Class.create();Rico.Accordion.Tab.prototype={initialize:function(e,t,n){this.accordion=e;this.titleBar=t;this.content=n;this._attachBehaviors()},collapse:function(){this.showCollapsed();this.content.style.height="1px"},showCollapsed:function(){this.expanded=false;this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg;this.titleBar.style.color=this.accordion.options.collapsedTextColor;this.titleBar.style.fontWeight=this.accordion.options.collapsedFontWeight;this.content.style.overflow="hidden"},showExpanded:function(){this.expanded=true;this.titleBar.style.backgroundColor=this.accordion.options.expandedBg;this.titleBar.style.color=this.accordion.options.expandedTextColor;this.content.style.overflow="visible"},titleBarClicked:function(e){if(this.accordion.lastExpandedTab==this)return;this.accordion.showTab(this)},hover:function(e){this.titleBar.style.backgroundColor=this.accordion.options.hoverBg;this.titleBar.style.color=this.accordion.options.hoverTextColor},unhover:function(e){if(this.expanded){this.titleBar.style.backgroundColor=this.accordion.options.expandedBg;this.titleBar.style.color=this.accordion.options.expandedTextColor}else{this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg;this.titleBar.style.color=this.accordion.options.collapsedTextColor}},_attachBehaviors:function(){this.content.style.border="1px solid "+this.accordion.options.borderColor;this.content.style.borderTopWidth="0px";this.content.style.borderBottomWidth="0px";this.content.style.margin="0px";this.titleBar.onclick=this.titleBarClicked.bindAsEventListener(this);this.titleBar.onmouseover=this.hover.bindAsEventListener(this);this.titleBar.onmouseout=this.unhover.bindAsEventListener(this)}};Rico.AjaxEngine=Class.create();Rico.AjaxEngine.prototype={initialize:function(){this.ajaxElements=new Array;this.ajaxObjects=new Array;this.requestURLS=new Array},registerAjaxElement:function(e,t){if(arguments.length==1)t=$(e);this.ajaxElements[e]=t},registerAjaxObject:function(e,t){this.ajaxObjects[e]=t},registerRequest:function(e,t){this.requestURLS[e]=t},sendRequest:function(e){var t=this.requestURLS[e];if(t==null)return;var n="";if(arguments.length>1){if(typeof arguments[1]=="object"&&arguments[1].length!=undefined){n=this._createQueryString(arguments[1],0)}else{n=this._createQueryString(arguments,1)}}new Ajax.Request(t,this._requestOptions(n))},sendRequestWithData:function(e,t){var n=this.requestURLS[e];if(n==null)return;var r="";if(arguments.length>2){if(typeof arguments[2]=="object"&&arguments[2].length!=undefined){r=this._createQueryString(arguments[2],0)}else{r=this._createQueryString(arguments,2)}}new Ajax.Request(n+"?"+r,this._requestOptions(null,t))},sendRequestAndUpdate:function(e,t,n){var r=this.requestURLS[e];if(r==null)return;var i="";if(arguments.length>3){if(typeof arguments[3]=="object"&&arguments[3].length!=undefined){i=this._createQueryString(arguments[3],0)}else{i=this._createQueryString(arguments,3)}}var s=this._requestOptions(i);s.onComplete=null;s.extend(n);new Ajax.Updater(t,r,s)},sendRequestWithDataAndUpdate:function(e,t,n,r){var i=this.requestURLS[e];if(i==null)return;var s="";if(arguments.length>4){if(typeof arguments[4]=="object"&&arguments[4].length!=undefined){s=this._createQueryString(arguments[4],0)}else{s=this._createQueryString(arguments,4)}}var o=this._requestOptions(s,t);o.onComplete=null;o.extend(r);new Ajax.Updater(n,i+"?"+s,o)},_requestOptions:function(e,t){var n=this;var r=["X-Rico-Version",Rico.Version];var i="post";if(arguments[1])r.push("Content-type","text/xml");else i="get";return{requestHeaders:r,parameters:e,postBody:arguments[1]?t:null,method:i,onComplete:n._onRequestComplete.bind(n)}},_createQueryString:function(e,t){var n=this;var r="";for(var i=t;i<e.length;i++){if(i!=t)r+="&";var s=e[i];if(s.name!=undefined&&s.value!=undefined){r+=s.name+"="+escape(s.value)}else{var o=s.indexOf("=");var u=s.substring(0,o);var a=s.substring(o+1);r+=u+"="+escape(a)}}return r},_onRequestComplete:function(e){if(e.status!=200)return;var t=e.responseXML.getElementsByTagName("ajax-response");if(t==null||t.length!=1)return;this._processAjaxResponse(t[0].childNodes)},_processAjaxResponse:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.nodeType!=1)continue;var r=n.getAttribute("type");var i=n.getAttribute("id");if(r=="object")this._processAjaxObjectUpdate(this.ajaxObjects[i],n);else if(r=="element")this._processAjaxElementUpdate(this.ajaxElements[i],n);else alert("unrecognized AjaxResponse type : "+r)}},_processAjaxObjectUpdate:function(e,t){e.ajaxUpdate(t)},_processAjaxElementUpdate:function(e,t){e.innerHTML=RicoUtil.getContentAsString(t)}};var ajaxEngine=new Rico.AjaxEngine;Rico.Color=Class.create();Rico.Color.prototype={initialize:function(e,t,n){this.rgb={r:e,g:t,b:n}},setRed:function(e){this.rgb.r=e},setGreen:function(e){this.rgb.g=e},setBlue:function(e){this.rgb.b=e},setHue:function(e){var t=this.asHSB();t.h=e;this.rgb=Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setSaturation:function(e){var t=this.asHSB();t.s=e;this.rgb=Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setBrightness:function(e){var t=this.asHSB();t.b=e;this.rgb=Rico.Color.HSBtoRGB(t.h,t.s,t.b)},darken:function(e){var t=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(t.h,t.s,Math.max(t.b-e,0))},brighten:function(e){var t=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(t.h,t.s,Math.min(t.b+e,1))},blend:function(e){this.rgb.r=Math.floor((this.rgb.r+e.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+e.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+e.rgb.b)/2)},isBright:function(){var e=this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}};Rico.Color.createFromHex=function(e){if(e.indexOf("#")==0)e=e.substring(1);var t=e.substring(0,2);var n=e.substring(2,4);var r=e.substring(4,6);return new Rico.Color(parseInt(t,16),parseInt(n,16),parseInt(r,16))};Rico.Color.createColorFromBackground=function(e){var t=RicoUtil.getElementsComputedStyle($(e),"backgroundColor","background-color");if(t=="transparent"&&e.parent)return Rico.Color.createColorFromBackground(e.parent);if(t==null)return new Rico.Color(255,255,255);if(t.indexOf("rgb(")==0){var n=t.substring(4,t.length-1);var r=n.split(",");return new Rico.Color(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]))}else if(t.indexOf("#")==0){var i=parseInt(t.substring(1,3),16);var s=parseInt(t.substring(3,5),16);var o=parseInt(t.substring(5),16);return new Rico.Color(i,s,o)}else return new Rico.Color(255,255,255)};Rico.Color.HSBtoRGB=function(e,t,n){var r=0;var i=0;var s=0;if(t==0){r=parseInt(n*255+.5);i=r;s=r}else{var o=(e-Math.floor(e))*6;var u=o-Math.floor(o);var a=n*(1-t);var f=n*(1-t*u);var l=n*(1-t*(1-u));switch(parseInt(o)){case 0:r=n*255+.5;i=l*255+.5;s=a*255+.5;break;case 1:r=f*255+.5;i=n*255+.5;s=a*255+.5;break;case 2:r=a*255+.5;i=n*255+.5;s=l*255+.5;break;case 3:r=a*255+.5;i=f*255+.5;s=n*255+.5;break;case 4:r=l*255+.5;i=a*255+.5;s=n*255+.5;break;case 5:r=n*255+.5;i=a*255+.5;s=f*255+.5;break}}return{r:parseInt(r),g:parseInt(i),b:parseInt(s)}};Rico.Color.RGBtoHSB=function(e,t,n){var r;var i;var s;var o=e>t?e:t;if(n>o)o=n;var u=e<t?e:t;if(n<u)u=n;s=o/255;if(o!=0)saturation=(o-u)/o;else saturation=0;if(saturation==0)r=0;else{var a=(o-e)/(o-u);var f=(o-t)/(o-u);var l=(o-n)/(o-u);if(e==o)r=l-f;else if(t==o)r=2+a-l;else r=4+f-a;r=r/6;if(r<0)r=r+1}return{h:r,s:saturation,b:s}};Rico.Corner={round:function(e,t){var e=$(e);this._setOptions(t);var n=this.options.color;if(this.options.color=="fromElement")n=this._background(e);var r=this.options.bgColor;if(this.options.bgColor=="fromParent")r=this._background(e.offsetParent);this._roundCornersImpl(e,n,r)},_roundCornersImpl:function(e,t,n){if(this.options.border)this._renderBorder(e,n);if(this._isTopRounded())this._roundTopCorners(e,t,n);if(this._isBottomRounded())this._roundBottomCorners(e,t,n)},_renderBorder:function(e,t){var n="1px solid "+this._borderColor(t);var r="border-left: "+n;var i="border-right: "+n;var s="style='"+r+";"+i+"'";e.innerHTML="<div "+s+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,t,n){var r=this._createCorner(n);for(var i=0;i<this.options.numSlices;i++)r.appendChild(this._createCornerSlice(t,n,i,"top"));e.style.paddingTop=0;e.insertBefore(r,e.firstChild)},_roundBottomCorners:function(e,t,n){var r=this._createCorner(n);for(var i=this.options.numSlices-1;i>=0;i--)r.appendChild(this._createCornerSlice(t,n,i,"bottom"));e.style.paddingBottom=0;e.appendChild(r)},_createCorner:function(e){var t=document.createElement("div");t.style.backgroundColor=this._isTransparent()?"transparent":e;return t},_createCornerSlice:function(e,t,n,r){var i=document.createElement("span");var s=i.style;s.backgroundColor=e;s.display="block";s.height="1px";s.overflow="hidden";s.fontSize="1px";var o=this._borderColor(e,t);if(this.options.border&&n==0){s.borderTopStyle="solid";s.borderTopWidth="1px";s.borderLeftWidth="0px";s.borderRightWidth="0px";s.borderBottomWidth="0px";s.height="0px";s.borderColor=o}else if(o){s.borderColor=o;s.borderStyle="solid";s.borderWidth="0px 1px"}if(!this.options.compact&&n==this.options.numSlices-1)s.height="2px";this._setMargin(i,n,r);this._setBorder(i,n,r);return i},_setOptions:function(e){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false}.extend(e||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent())this.options.blend=false},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top"))return"";if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0)return"";if(this.options.corners.indexOf("tl")>=0)return"left";else if(this.options.corners.indexOf("tr")>=0)return"right";return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom"))return"";if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0)return"";if(this.options.corners.indexOf("bl")>=0)return"left";else if(this.options.corners.indexOf("br")>=0)return"right";return""},_borderColor:function(e,t){if(e=="transparent")return t;else if(this.options.border)return this.options.border;else if(this.options.blend)return this._blend(t,e);else return""},_setMargin:function(e,t,n){var r=this._marginSize(t);var i=n=="top"?this._whichSideTop():this._whichSideBottom();if(i=="left"){e.style.marginLeft=r+"px";e.style.marginRight="0px"}else if(i=="right"){e.style.marginRight=r+"px";e.style.marginLeft="0px"}else{e.style.marginLeft=r+"px";e.style.marginRight=r+"px"}},_setBorder:function(e,t,n){var r=this._borderSize(t);var i=n=="top"?this._whichSideTop():this._whichSideBottom();if(i=="left"){e.style.borderLeftWidth=r+"px";e.style.borderRightWidth="0px"}else if(i=="right"){e.style.borderRightWidth=r+"px";e.style.borderLeftWidth="0px"}else{e.style.borderLeftWidth=r+"px";e.style.borderRightWidth=r+"px"}},_marginSize:function(e){if(this._isTransparent())return 0;var t=[5,3,2,1];var n=[3,2,1,0];var r=[2,1];var i=[1,0];if(this.options.compact&&this.options.blend)return i[e];else if(this.options.compact)return r[e];else if(this.options.blend)return n[e];else return t[e]},_borderSize:function(e){var t=[5,3,2,1];var n=[2,1,1,1];var r=[1,0];var i=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent()))return 1;else if(this.options.compact)return r[e];else if(this.options.blend)return n[e];else if(this.options.border)return i[e];else if(this._isTransparent())return t[e];return 0},_hasString:function(e){for(var t=1;t<arguments.length;t++)if(e.indexOf(arguments[t])>=0)return true;return false},_blend:function(e,t){var n=Rico.Color.createFromHex(e);n.blend(Rico.Color.createFromHex(t));return n},_background:function(e){try{return Rico.Color.createColorFromBackground(e).asHex()}catch(t){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(e){return e.childNodes.length==1&&e.childNodes[0].nodeType==3}};Rico.DragAndDrop=Class.create();Rico.DragAndDrop.prototype={initialize:function(){this.dropZones=new Array;this.draggables=new Array;this.currentDragObjects=new Array;this.dragElement=null;this.lastSelectedDraggable=null;this.currentDragObjectVisible=false;this.interestedInMotionEvents=false},registerDropZone:function(e){this.dropZones[this.dropZones.length]=e},deregisterDropZone:function(e){var t=new Array;var n=0;for(var r=0;r<this.dropZones.length;r++){if(this.dropZones[r]!=e)t[n++]=this.dropZones[r]}this.dropZones=t},clearDropZones:function(){this.dropZones=new Array},registerDraggable:function(e){this.draggables[this.draggables.length]=e;this._addMouseDownHandler(e)},clearSelection:function(){for(var e=0;e<this.currentDragObjects.length;e++)this.currentDragObjects[e].deselect();this.currentDragObjects=new Array;this.lastSelectedDraggable=null},hasSelection:function(){return this.currentDragObjects.length>0},setStartDragFromElement:function(e,t){this.origPos=RicoUtil.toDocumentPosition(t);this.startx=e.screenX-this.origPos.x;this.starty=e.screenY-this.origPos.y;this.interestedInMotionEvents=this.hasSelection();this._terminateEvent(e)},updateSelection:function(e,t){if(!t)this.clearSelection();if(e.isSelected()){this.currentDragObjects.removeItem(e);e.deselect();if(e==this.lastSelectedDraggable)this.lastSelectedDraggable=null}else{this.currentDragObjects[this.currentDragObjects.length]=e;e.select();this.lastSelectedDraggable=e}},_mouseDownHandler:function(e){if(arguments.length==0)e=event;var t=e.which!=undefined;if(t&&e.which!=1||!t&&e.button!=1)return;var n=e.target?e.target:e.srcElement;var r=n.draggable;var i=n;while(r==null&&i.parentNode){i=i.parentNode;r=i.draggable}if(r==null)return;this.updateSelection(r,e.ctrlKey);if(this.hasSelection())for(var s=0;s<this.dropZones.length;s++)this.dropZones[s].clearPositionCache();this.setStartDragFromElement(e,r.getMouseDownHTMLElement())},_mouseMoveHandler:function(e){var t=e.which!=undefined;if(!this.interestedInMotionEvents){this._terminateEvent(e);return}if(!this.hasSelection())return;if(!this.currentDragObjectVisible)this._startDrag(e);if(!this.activatedDropZones)this._activateRegisteredDropZones();this._updateDraggableLocation(e);this._updateDropZonesHover(e);this._terminateEvent(e)},_makeDraggableObjectVisible:function(e){if(!this.hasSelection())return;var t;if(this.currentDragObjects.length>1)t=this.currentDragObjects[0].getMultiObjectDragGUI(this.currentDragObjects);else t=this.currentDragObjects[0].getSingleObjectDragGUI();if(RicoUtil.getElementsComputedStyle(t,"position")!="absolute")t.style.position="absolute";if(t.parentNode==null||t.parentNode.nodeType==11)document.body.appendChild(t);this.dragElement=t;this._updateDraggableLocation(e);this.currentDragObjectVisible=true},_updateDraggableLocation:function(e){var t=this.dragElement.style;t.left=e.screenX-this.startx+"px";t.top=e.screenY-this.starty+"px"},_updateDropZonesHover:function(e){var t=this.dropZones.length;for(var n=0;n<t;n++){if(!this._mousePointInDropZone(e,this.dropZones[n]))this.dropZones[n].hideHover()}for(var n=0;n<t;n++){if(this._mousePointInDropZone(e,this.dropZones[n])){if(this.dropZones[n].canAccept(this.currentDragObjects))this.dropZones[n].showHover()}}},_startDrag:function(e){for(var t=0;t<this.currentDragObjects.length;t++)this.currentDragObjects[t].startDrag();this._makeDraggableObjectVisible(e)},_mouseUpHandler:function(e){if(!this.hasSelection())return;var t=e.which!=undefined;if(t&&e.which!=1||!t&&e.button!=1)return;this.interestedInMotionEvents=false;if(this.dragElement==null){this._terminateEvent(e);return}if(this._placeDraggableInDropZone(e))this._completeDropOperation(e);else{this._terminateEvent(e);new Effect.Position(this.dragElement,this.origPos.x,this.origPos.y,200,20,{complete:this._doCancelDragProcessing.bind(this)})}},_completeDropOperation:function(e){if(this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()){if(this.dragElement.parentNode!=null)this.dragElement.parentNode.removeChild(this.dragElement)}this._deactivateRegisteredDropZones();this._endDrag();this.clearSelection();this.dragElement=null;this.currentDragObjectVisible=false;this._terminateEvent(e)},_doCancelDragProcessing:function(){this._cancelDrag();if(this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()){if(this.dragElement.parentNode!=null){this.dragElement.parentNode.removeChild(this.dragElement)}}this._deactivateRegisteredDropZones();this.dragElement=null;this.currentDragObjectVisible=false},_placeDraggableInDropZone:function(e){var t=false;var n=this.dropZones.length;for(var r=0;r<n;r++){if(this._mousePointInDropZone(e,this.dropZones[r])){if(this.dropZones[r].canAccept(this.currentDragObjects)){this.dropZones[r].hideHover();this.dropZones[r].accept(this.currentDragObjects);t=true;break}}}return t},_cancelDrag:function(){for(var e=0;e<this.currentDragObjects.length;e++)this.currentDragObjects[e].cancelDrag()},_endDrag:function(){for(var e=0;e<this.currentDragObjects.length;e++)this.currentDragObjects[e].endDrag()},_mousePointInDropZone:function(e,t){var n=t.getAbsoluteRect();return e.clientX>n.left&&e.clientX<n.right&&e.clientY>n.top&&e.clientY<n.bottom},_addMouseDownHandler:function(e){var t=e.getMouseDownHTMLElement();if(t!=null){t.draggable=e;this._addMouseDownEvent(t)}},_activateRegisteredDropZones:function(){var e=this.dropZones.length;for(var t=0;t<e;t++){var n=this.dropZones[t];if(n.canAccept(this.currentDragObjects))n.activate()}this.activatedDropZones=true},_deactivateRegisteredDropZones:function(){var e=this.dropZones.length;for(var t=0;t<e;t++)this.dropZones[t].deactivate();this.activatedDropZones=false},_addMouseDownEvent:function(e){if(typeof document.implementation!="undefined"&&document.implementation.hasFeature("HTML","1.0")&&document.implementation.hasFeature("Events","2.0")&&document.implementation.hasFeature("CSS","2.0")){e.addEventListener("mousedown",this._mouseDownHandler.bindAsEventListener(this),false)}else{e.attachEvent("onmousedown",this._mouseDownHandler.bindAsEventListener(this))}},_terminateEvent:function(e){if(e.stopPropagation!=undefined)e.stopPropagation();else if(e.cancelBubble!=undefined)e.cancelBubble=true;if(e.preventDefault!=undefined)e.preventDefault();else e.returnValue=false},initializeEventHandlers:function(){if(typeof document.implementation!="undefined"&&document.implementation.hasFeature("HTML","1.0")&&document.implementation.hasFeature("Events","2.0")&&document.implementation.hasFeature("CSS","2.0")){document.addEventListener("mouseup",this._mouseUpHandler.bindAsEventListener(this),false);document.addEventListener("mousemove",this._mouseMoveHandler.bindAsEventListener(this),false)}else{document.attachEvent("onmouseup",this._mouseUpHandler.bindAsEventListener(this));document.attachEvent("onmousemove",this._mouseMoveHandler.bindAsEventListener(this))}}};Rico.Draggable=Class.create();Rico.Draggable.prototype={initialize:function(e,t){this.type=e;this.htmlElement=$(t);this.selected=false},getMouseDownHTMLElement:function(){return this.htmlElement},select:function(){this.selected=true;if(this.showingSelected)return;var e=this.getMouseDownHTMLElement();var t=Rico.Color.createColorFromBackground(e);t.isBright()?t.darken(.033):t.brighten(.033);this.saveBackground=RicoUtil.getElementsComputedStyle(e,"backgroundColor","background-color");e.style.backgroundColor=t.asHex();this.showingSelected=true},deselect:function(){this.selected=false;if(!this.showingSelected)return;var e=this.getMouseDownHTMLElement();e.style.backgroundColor=this.saveBackground;this.showingSelected=false},isSelected:function(){return this.selected},startDrag:function(){},cancelDrag:function(){},endDrag:function(){},getSingleObjectDragGUI:function(){return this.htmlElement},getMultiObjectDragGUI:function(e){return this.htmlElement},getDroppedGUI:function(){return this.htmlElement},toString:function(){return this.type+":"+this.htmlElement+":"}};Rico.Dropzone=Class.create();Rico.Dropzone.prototype={initialize:function(e){this.htmlElement=$(e);this.absoluteRect=null},getHTMLElement:function(){return this.htmlElement},clearPositionCache:function(){this.absoluteRect=null},getAbsoluteRect:function(){if(this.absoluteRect==null){var e=this.getHTMLElement();var t=RicoUtil.toViewportPosition(e);this.absoluteRect={top:t.y,left:t.x,bottom:t.y+e.offsetHeight,right:t.x+e.offsetWidth}}return this.absoluteRect},activate:function(){var e=this.getHTMLElement();if(e==null||this.showingActive)return;this.showingActive=true;this.saveBackgroundColor=e.style.backgroundColor;var t="#ffea84";var n=Rico.Color.createColorFromBackground(e);if(n==null)e.style.backgroundColor=t;else{n.isBright()?n.darken(.2):n.brighten(.2);e.style.backgroundColor=n.asHex()}},deactivate:function(){var e=this.getHTMLElement();if(e==null||!this.showingActive)return;e.style.backgroundColor=this.saveBackgroundColor;this.showingActive=false;this.saveBackgroundColor=null},showHover:function(){var e=this.getHTMLElement();if(e==null||this.showingHover)return;this.saveBorderWidth=e.style.borderWidth;this.saveBorderStyle=e.style.borderStyle;this.saveBorderColor=e.style.borderColor;this.showingHover=true;e.style.borderWidth="1px";e.style.borderStyle="solid";e.style.borderColor="#ffff00"},hideHover:function(){var e=this.getHTMLElement();if(e==null||!this.showingHover)return;e.style.borderWidth=this.saveBorderWidth;e.style.borderStyle=this.saveBorderStyle;e.style.borderColor=this.saveBorderColor;this.showingHover=false},canAccept:function(e){return true},accept:function(e){var t=this.getHTMLElement();if(t==null)return;n=e.length;for(var r=0;r<n;r++){var i=e[r].getDroppedGUI();if(RicoUtil.getElementsComputedStyle(i,"position")=="absolute"){i.style.position="static";i.style.top="";i.style.top=""}t.appendChild(i)}}};if(window.Effect==undefined)Effect={};Effect.SizeAndPosition=Class.create();Effect.SizeAndPosition.prototype={initialize:function(e,t,n,r,i,s,o,u){this.element=$(e);this.x=t;this.y=n;this.w=r;this.h=i;this.duration=s;this.steps=o;this.options=arguments[7]||{};this.sizeAndPosition()},sizeAndPosition:function(){if(this.isFinished()){if(this.options.complete)this.options.complete(this);return}if(this.timer)clearTimeout(this.timer);var e=Math.round(this.duration/this.steps);var t=this.element.offsetLeft;var n=this.element.offsetTop;var r=this.element.offsetWidth;var i=this.element.offsetHeight;this.x=this.x?this.x:t;this.y=this.y?this.y:n;this.w=this.w?this.w:r;this.h=this.h?this.h:i;var s=this.steps>0?(this.x-t)/this.steps:0;var o=this.steps>0?(this.y-n)/this.steps:0;var u=this.steps>0?(this.w-r)/this.steps:0;var a=this.steps>0?(this.h-i)/this.steps:0;this.moveBy(s,o);this.resizeBy(u,a);this.duration-=e;this.steps--;this.timer=setTimeout(this.sizeAndPosition.bind(this),e)},isFinished:function(){return this.steps<=0},moveBy:function(e,t){var n=this.element.offsetLeft;var r=this.element.offsetTop;var i=parseInt(e);var s=parseInt(t);var o=this.element.style;if(i!=0)o.left=n+i+"px";if(s!=0)o.top=r+s+"px"},resizeBy:function(e,t){var n=this.element.offsetWidth;var r=this.element.offsetHeight;var i=parseInt(e);var s=parseInt(t);var o=this.element.style;if(i!=0)o.width=n+i+"px";if(s!=0)o.height=r+s+"px"}};Effect.Size=Class.create();Effect.Size.prototype={initialize:function(e,t,n,r,i,s){new Effect.SizeAndPosition(e,null,null,t,n,r,i,s)}};Effect.Position=Class.create();Effect.Position.prototype={initialize:function(e,t,n,r,i,s){new Effect.SizeAndPosition(e,t,n,null,null,r,i,s)}};Effect.Round=Class.create();Effect.Round.prototype={initialize:function(e,t,n){var r=document.getElementsByTagAndClassName(e,t);for(var i=0;i<r.length;i++)Rico.Corner.round(r[i],n)}};Effect.FadeTo=Class.create();Effect.FadeTo.prototype={initialize:function(e,t,n,r,i){this.element=$(e);this.opacity=t;this.duration=n;this.steps=r;this.options=arguments[4]||{};this.fadeTo()},fadeTo:function(){if(this.isFinished()){if(this.options.complete)this.options.complete(this);return}if(this.timer)clearTimeout(this.timer);var e=Math.round(this.duration/this.steps);var t=this.getElementOpacity();var n=this.steps>0?(this.opacity-t)/this.steps:0;this.changeOpacityBy(n);this.duration-=e;this.steps--;this.timer=setTimeout(this.fadeTo.bind(this),e)},changeOpacityBy:function(e){var t=this.getElementOpacity();var n=Math.max(0,Math.min(t+e,1));this.element.ricoOpacity=n;this.element.style.filter="alpha(opacity:"+Math.round(n*100)+")";this.element.style.opacity=n;},isFinished:function(){return this.steps<=0},getElementOpacity:function(){if(this.element.ricoOpacity==undefined){var e;if(this.element.currentStyle){e=this.element.currentStyle.opacity}else if(document.defaultView.getComputedStyle!=undefined){var t=document.defaultView.getComputedStyle;e=t(this.element,null).getPropertyValue("opacity")}this.element.ricoOpacity=e!=undefined?e:1}return parseFloat(this.element.ricoOpacity)}};Effect.AccordionSize=Class.create();Effect.AccordionSize.prototype={initialize:function(e,t,n,r,i,s,o){this.e1=$(e);this.e2=$(t);this.start=n;this.end=r;this.duration=i;this.steps=s;this.options=arguments[6]||{};this.accordionSize()},accordionSize:function(){if(this.isFinished()){this.e1.style.height=this.start+"px";this.e2.style.height=this.end+"px";if(this.options.complete)this.options.complete(this);return}if(this.timer)clearTimeout(this.timer);var e=Math.round(this.duration/this.steps);var t=this.steps>0?(parseInt(this.e1.offsetHeight)-this.start)/this.steps:0;this.resizeBy(t);this.duration-=e;this.steps--;this.timer=setTimeout(this.accordionSize.bind(this),e)},isFinished:function(){return this.steps<=0},resizeBy:function(e){var t=this.e1.offsetHeight;var n=this.e2.offsetHeight;var r=parseInt(e);if(e!=0){this.e1.style.height=t-r+"px";this.e2.style.height=n+r+"px"}}};Rico.LiveGridMetaData=Class.create();Rico.LiveGridMetaData.prototype={initialize:function(e,t,n,r){this.pageSize=e;this.totalRows=t;this.setOptions(r);this.scrollArrowHeight=16;this.columnCount=n},setOptions:function(e){this.options={largeBufferSize:7,nearLimitFactor:.2}.extend(e||{})},getPageSize:function(){return this.pageSize},getTotalRows:function(){return this.totalRows},setTotalRows:function(e){this.totalRows=e},getLargeBufferSize:function(){return parseInt(this.options.largeBufferSize*this.pageSize)},getLimitTolerance:function(){return parseInt(this.getLargeBufferSize()*this.options.nearLimitFactor)}};Rico.LiveGridScroller=Class.create();Rico.LiveGridScroller.prototype={initialize:function(e,t){this.isIE=navigator.userAgent.toLowerCase().indexOf("msie")>=0;this.liveGrid=e;this.metaData=e.metaData;this.createScrollBar();this.scrollTimeout=null;this.lastScrollPos=0;this.viewPort=t;this.rows=new Array},isUnPlugged:function(){return this.scrollerDiv.onscroll==null},plugin:function(){this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this)},unplug:function(){this.scrollerDiv.onscroll=null},sizeIEHeaderHack:function(){if(!this.isIE)return;var e=$(this.liveGrid.tableId+"_header");if(e)e.rows[0].cells[0].style.width=e.rows[0].cells[0].offsetWidth+1+"px"},createScrollBar:function(){var e=this.liveGrid.viewPort.visibleHeight();this.scrollerDiv=document.createElement("div");var t=this.scrollerDiv.style;t.borderRight="1px solid #ababab";t.position="relative";t.left=this.isIE?"-6px":"-3px";t.width="19px";t.height=e+"px";t.overflow="auto";this.heightDiv=document.createElement("div");this.heightDiv.style.width="1px";this.heightDiv.style.height=parseInt(e*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px";this.scrollerDiv.appendChild(this.heightDiv);this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this);var n=this.liveGrid.table;n.parentNode.parentNode.insertBefore(this.scrollerDiv,n.parentNode.nextSibling)},updateSize:function(){var e=this.liveGrid.table;var t=this.viewPort.visibleHeight();this.heightDiv.style.height=parseInt(t*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px"},rowToPixel:function(e){return e/this.metaData.getTotalRows()*this.heightDiv.offsetHeight},moveScroll:function(e){this.scrollerDiv.scrollTop=this.rowToPixel(e);if(this.metaData.options.onscroll)this.metaData.options.onscroll(this.liveGrid,e)},handleScroll:function(){if(this.scrollTimeout)clearTimeout(this.scrollTimeout);var e=parseInt(this.scrollerDiv.scrollTop/this.viewPort.rowHeight);this.liveGrid.requestContentRefresh(e);this.viewPort.scrollTo(this.scrollerDiv.scrollTop);if(this.metaData.options.onscroll)this.metaData.options.onscroll(this.liveGrid,e);this.scrollTimeout=setTimeout(this.scrollIdle.bind(this),1200)},scrollIdle:function(){if(this.metaData.options.onscrollidle)this.metaData.options.onscrollidle()}};Rico.LiveGridBuffer=Class.create();Rico.LiveGridBuffer.prototype={initialize:function(e,t){this.startPos=0;this.size=0;this.metaData=e;this.rows=new Array;this.updateInProgress=false;this.viewPort=t;this.maxBufferSize=e.getLargeBufferSize()*2;this.maxFetchSize=e.getLargeBufferSize();this.lastOffset=0},getBlankRow:function(){if(!this.blankRow){this.blankRow=new Array;for(var e=0;e<this.metaData.columnCount;e++)this.blankRow[e]="&nbsp;"}return this.blankRow},loadRows:function(e){var t=e.getElementsByTagName("rows")[0];this.updateUI=t.getAttribute("update_ui")=="true";var n=new Array;var r=t.getElementsByTagName("tr");for(var i=0;i<r.length;i++){var s=n[i]=new Array;var o=r[i].getElementsByTagName("td");for(var u=0;u<o.length;u++){var a=o[u];var f=a.getAttribute("convert_spaces")=="true";var l=RicoUtil.getContentAsString(a);s[u]=f?this.convertSpaces(l):l;if(!s[u])s[u]="&nbsp;"}}return n},update:function(e,t){var n=this.loadRows(e);if(this.rows.length==0){this.rows=n;this.size=this.rows.length;this.startPos=t;return}if(t>this.startPos){if(this.startPos+this.rows.length<t){this.rows=n;this.startPos=t}else{this.rows=this.rows.concat(n.slice(0,n.length));if(this.rows.length>this.maxBufferSize){var r=this.rows.length;this.rows=this.rows.slice(this.rows.length-this.maxBufferSize,this.rows.length);this.startPos=this.startPos+(r-this.rows.length)}}}else{if(t+n.length<this.startPos){this.rows=n}else{this.rows=n.slice(0,this.startPos).concat(this.rows);if(this.rows.length>this.maxBufferSize)this.rows=this.rows.slice(0,this.maxBufferSize)}this.startPos=t}this.size=this.rows.length},clear:function(){this.rows=new Array;this.startPos=0;this.size=0},isOverlapping:function(e,t){return e<this.endPos()&&this.startPos<e+t||this.endPos()==0},isInRange:function(e){return e>=this.startPos&&e+this.metaData.getPageSize()<=this.endPos()},isNearingTopLimit:function(e){return e-this.startPos<this.metaData.getLimitTolerance()},endPos:function(){return this.startPos+this.rows.length},isNearingBottomLimit:function(e){return this.endPos()-(e+this.metaData.getPageSize())<this.metaData.getLimitTolerance()},isAtTop:function(){return this.startPos==0},isAtBottom:function(){return this.endPos()==this.metaData.getTotalRows()},isNearingLimit:function(e){return!this.isAtTop()&&this.isNearingTopLimit(e)||!this.isAtBottom()&&this.isNearingBottomLimit(e)},getFetchSize:function(e){var t=this.getFetchOffset(e);var n=0;if(t>=this.startPos){var r=this.maxFetchSize+t;if(r>this.metaData.totalRows)r=this.metaData.totalRows;n=r-t}else{var n=this.startPos-t;if(n>this.maxFetchSize)n=this.maxFetchSize}return n},getFetchOffset:function(e){var t=e;if(e>this.startPos)t=e>this.endPos()?e:this.endPos();else{if(e+this.maxFetchSize>=this.startPos){var t=this.startPos-this.maxFetchSize;if(t<0)t=0}}this.lastOffset=t;return t},getRows:function(e,t){var n=e-this.startPos;var r=n+t;if(r>this.size)r=this.size;var i=new Array;var s=0;for(var o=n;o<r;o++){i[s++]=this.rows[o]}return i},convertSpaces:function(e){return e.split(" ").join("&nbsp;")}};Rico.GridViewPort=Class.create();Rico.GridViewPort.prototype={initialize:function(e,t,n,r,i){this.lastDisplayedStartPos=0;this.div=e.parentNode;this.table=e;this.rowHeight=t;this.div.style.height=this.rowHeight*n;this.div.style.overflow="hidden";this.buffer=r;this.liveGrid=i;this.visibleRows=n+1;this.lastPixelOffset=0;this.startPos=0},populateRow:function(e,t){for(var n=0;n<t.length;n++){e.cells[n].innerHTML=t[n]}},bufferChanged:function(){this.refreshContents(parseInt(this.lastPixelOffset/this.rowHeight))},clearRows:function(){if(!this.isBlank){for(var e=0;e<this.visibleRows;e++)this.populateRow(this.table.rows[e],this.buffer.getBlankRow());this.isBlank=true}},clearContents:function(){this.clearRows();this.scrollTo(0);this.startPos=0;this.lastStartPos=-1},refreshContents:function(e){if(e==this.lastRowPos&&!this.isPartialBlank&&!this.isBlank){return}if(e+this.visibleRows<this.buffer.startPos||this.buffer.startPos+this.buffer.size<e||this.buffer.size==0){this.clearRows();return}this.isBlank=false;var t=this.buffer.startPos>e;var n=t?this.buffer.startPos:e;var r=this.buffer.startPos+this.buffer.size<e+this.visibleRows?this.buffer.startPos+this.buffer.size:e+this.visibleRows;var i=r-n;var s=this.buffer.getRows(n,i);var o=this.visibleRows-i;var u=t?0:i;var a=t?o:0;for(var f=0;f<s.length;f++){this.populateRow(this.table.rows[f+a],s[f])}for(var f=0;f<o;f++){this.populateRow(this.table.rows[f+u],this.buffer.getBlankRow())}this.isPartialBlank=o>0;this.lastRowPos=e},scrollTo:function(e){if(this.lastPixelOffset==e)return;this.refreshContents(parseInt(e/this.rowHeight));this.div.scrollTop=e%this.rowHeight;this.lastPixelOffset=e},visibleHeight:function(){return parseInt(this.div.style.height)}};Rico.LiveGridRequest=Class.create();Rico.LiveGridRequest.prototype={initialize:function(e,t){this.requestOffset=e}};Rico.LiveGrid=Class.create();Rico.LiveGrid.prototype={initialize:function(e,t,n,r,i){if(i==null)i={};this.tableId=e;this.table=$(e);var s=this.table.rows[0].cells.length;this.metaData=new Rico.LiveGridMetaData(t,n,s,i);this.buffer=new Rico.LiveGridBuffer(this.metaData);var o=this.table.rows.length;this.viewPort=new Rico.GridViewPort(this.table,this.table.offsetHeight/o,t,this.buffer,this);this.scroller=new Rico.LiveGridScroller(this,this.viewPort);this.additionalParms=i.requestParameters||[];i.sortHandler=this.sortHandler.bind(this);if($(e+"_header"))this.sort=new Rico.LiveGridSort(e+"_header",i);this.processingRequest=null;this.unprocessedRequest=null;this.initAjax(r);if(i.prefetchBuffer||i.prefetchOffset>0){var u=0;if(i.offset){u=i.offset;this.scroller.moveScroll(u);this.viewPort.scrollTo(this.scroller.rowToPixel(u))}if(i.sortCol){this.sortCol=i.sortCol;this.sortDir=i.sortDir}this.requestContentRefresh(u)}},resetContents:function(){this.scroller.moveScroll(0);this.buffer.clear();this.viewPort.clearContents()},sortHandler:function(e){this.sortCol=e.name;this.sortDir=e.currentSort;this.resetContents();this.requestContentRefresh(0)},setRequestParams:function(){this.additionalParms=[];for(var e=0;e<arguments.length;e++)this.additionalParms[e]=arguments[e]},setTotalRows:function(e){this.resetContents();this.metaData.setTotalRows(e);this.scroller.updateSize()},initAjax:function(e){ajaxEngine.registerRequest(this.tableId+"_request",e);ajaxEngine.registerAjaxObject(this.tableId+"_updater",this)},invokeAjax:function(){},handleTimedOut:function(){this.processingRequest=null;this.processQueuedRequest()},fetchBuffer:function(e){if(this.buffer.isInRange(e)&&!this.buffer.isNearingLimit(e)){return}if(this.processingRequest){this.unprocessedRequest=new Rico.LiveGridRequest(e);return}var t=this.buffer.getFetchOffset(e);this.processingRequest=new Rico.LiveGridRequest(e);this.processingRequest.bufferOffset=t;var n=this.buffer.getFetchSize(e);var r=false;var i=[];i.push(this.tableId+"_request");i.push("id="+this.tableId);i.push("page_size="+n);i.push("offset="+t);if(this.sortCol){i.push("sort_col="+this.sortCol);i.push("sort_dir="+this.sortDir)}for(var s=0;s<this.additionalParms.length;s++)i.push(this.additionalParms[s]);ajaxEngine.sendRequest.apply(ajaxEngine,i);this.timeoutHandler=setTimeout(this.handleTimedOut.bind(this),2e4)},requestContentRefresh:function(e){this.fetchBuffer(e)},ajaxUpdate:function(e){try{clearTimeout(this.timeoutHandler);this.buffer.update(e,this.processingRequest.bufferOffset);this.viewPort.bufferChanged()}catch(t){}finally{this.processingRequest=null}this.processQueuedRequest()},processQueuedRequest:function(){if(this.unprocessedRequest!=null){this.requestContentRefresh(this.unprocessedRequest.requestOffset);this.unprocessedRequest=null}}};Rico.LiveGridSort=Class.create();Rico.LiveGridSort.prototype={initialize:function(e,t){this.headerTableId=e;this.headerTable=$(e);this.setOptions(t);this.applySortBehavior();if(this.options.sortCol){this.setSortUI(this.options.sortCol,this.options.sortDir)}},setSortUI:function(e,t){var n=this.options.columns;for(var r=0;r<n.length;r++){if(n[r].name==e){this.setColumnSort(r,t);break}}},setOptions:function(e){this.options={sortAscendImg:"images/sort_asc.gif",sortDescendImg:"images/sort_desc.gif",imageWidth:9,imageHeight:5,ajaxSortURLParms:[]}.extend(e);(new Image).src=this.options.sortAscendImg;(new Image).src=this.options.sortDescendImg;this.sort=e.sortHandler;if(!this.options.columns)this.options.columns=this.introspectForColumnInfo();else{this.options.columns=this.convertToTableColumns(this.options.columns)}},applySortBehavior:function(){var e=this.headerTable.rows[0];var t=e.cells;for(var n=0;n<t.length;n++){this.addSortBehaviorToColumn(n,t[n])}},addSortBehaviorToColumn:function(e,t){if(this.options.columns[e].isSortable()){t.id=this.headerTableId+"_"+e;t.style.cursor="pointer";t.onclick=this.headerCellClicked.bindAsEventListener(this);t.innerHTML=t.innerHTML+'<span id="'+this.headerTableId+"_img_"+e+'">'+"&nbsp;&nbsp;&nbsp;</span>"}},headerCellClicked:function(e){var t=e.target?e.target:e.srcElement;var n=t.id;var r=parseInt(n.substring(n.lastIndexOf("_")+1));var i=this.getSortedColumnIndex();if(i!=-1){if(i!=r){this.removeColumnSort(i);this.setColumnSort(r,Rico.TableColumn.SORT_ASC)}else this.toggleColumnSort(i)}else this.setColumnSort(r,Rico.TableColumn.SORT_ASC);if(this.options.sortHandler){this.options.sortHandler(this.options.columns[r])}},removeColumnSort:function(e){this.options.columns[e].setUnsorted();this.setSortImage(e)},setColumnSort:function(e,t){this.options.columns[e].setSorted(t);this.setSortImage(e)},toggleColumnSort:function(e){this.options.columns[e].toggleSort();this.setSortImage(e)},setSortImage:function(e){var t=this.options.columns[e].getSortDirection();var n=$(this.headerTableId+"_img_"+e);if(t==Rico.TableColumn.UNSORTED)n.innerHTML="&nbsp;&nbsp;";else if(t==Rico.TableColumn.SORT_ASC)n.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" '+'height="'+this.options.imageHeight+'" '+'src="'+this.options.sortAscendImg+'"/>';else if(t==Rico.TableColumn.SORT_DESC)n.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" '+'height="'+this.options.imageHeight+'" '+'src="'+this.options.sortDescendImg+'"/>'},getSortedColumnIndex:function(){var e=this.options.columns;for(var t=0;t<e.length;t++){if(e[t].isSorted())return t}return-1},introspectForColumnInfo:function(){var e=new Array;var t=this.headerTable.rows[0];var n=t.cells;for(var r=0;r<n.length;r++)e.push(new Rico.TableColumn(this.deriveColumnNameFromCell(n[r],r),true));return e},convertToTableColumns:function(e){var t=new Array;for(var n=0;n<e.length;n++)t.push(new Rico.TableColumn(e[n][0],e[n][1]))},deriveColumnNameFromCell:function(e,t){var n=e.innerText!=undefined?e.innerText:e.textContent;return n?n.toLowerCase().split(" ").join("_"):"col_"+t}};Rico.TableColumn=Class.create();Rico.TableColumn.UNSORTED=0;Rico.TableColumn.SORT_ASC="ASC";Rico.TableColumn.SORT_DESC="DESC";Rico.TableColumn.prototype={initialize:function(e,t){this.name=e;this.sortable=t;this.currentSort=Rico.TableColumn.UNSORTED},isSortable:function(){return this.sortable},isSorted:function(){return this.currentSort!=Rico.TableColumn.UNSORTED},getSortDirection:function(){return this.currentSort},toggleSort:function(){if(this.currentSort==Rico.TableColumn.UNSORTED||this.currentSort==Rico.TableColumn.SORT_DESC)this.currentSort=Rico.TableColumn.SORT_ASC;else if(this.currentSort==Rico.TableColumn.SORT_ASC)this.currentSort=Rico.TableColumn.SORT_DESC},setUnsorted:function(e){this.setSorted(Rico.TableColumn.UNSORTED)},setSorted:function(e){this.currentSort=e}};var RicoUtil={getElementsComputedStyle:function(e,t,n){if(arguments.length==2)n=t;var r=$(e);if(r.currentStyle)return r.currentStyle[t];else return document.defaultView.getComputedStyle(r,null).getPropertyValue(n)},createXmlDocument:function(){if(document.implementation&&document.implementation.createDocument){var e=document.implementation.createDocument("","",null);if(e.readyState==null){e.readyState=1;e.addEventListener("load",function(){e.readyState=4;if(typeof e.onreadystatechange=="function")e.onreadystatechange()},false)}return e}if(window.ActiveXObject)return Try.these(function(){return new ActiveXObject("MSXML2.DomDocument")},function(){return new ActiveXObject("Microsoft.DomDocument")},function(){return new ActiveXObject("MSXML.DomDocument")},function(){return new ActiveXObject("MSXML3.DomDocument")})||false;return null},getContentAsString:function(e){return e.xml!=undefined?this._getContentAsStringIE(e):this._getContentAsStringMozilla(e)},_getContentAsStringIE:function(e){var t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].xml;return t},_getContentAsStringMozilla:function(e){var t=new XMLSerializer;var n="";for(var r=0;r<e.childNodes.length;r++)n+=t.serializeToString(e.childNodes[r]);return n},toViewportPosition:function(e){return this._toAbsolute(e,true)},toDocumentPosition:function(e){return this._toAbsolute(e,false)},_toAbsolute:function(e,t){if(navigator.userAgent.toLowerCase().indexOf("msie")==-1)return this._toAbsoluteMozilla(e,t);var n=0;var r=0;var i=e;while(i){var s=0;var o=0;if(i!=e){var s=parseInt(this.getElementsComputedStyle(i,"borderLeftWidth"));var o=parseInt(this.getElementsComputedStyle(i,"borderTopWidth"));s=isNaN(s)?0:s;o=isNaN(o)?0:o}n+=i.offsetLeft-i.scrollLeft+s;r+=i.offsetTop-i.scrollTop+o;i=i.offsetParent}if(t){n-=this.docScrollLeft();r-=this.docScrollTop()}return{x:n,y:r}},_toAbsoluteMozilla:function(e,t){var n=0;var r=0;var i=e;while(i){n+=i.offsetLeft;r+=i.offsetTop;i=i.offsetParent}i=e;while(i&&i!=document.body&&i!=document.documentElement){if(i.scrollLeft)n-=i.scrollLeft;if(i.scrollTop)r-=i.scrollTop;i=i.parentNode}if(t){n-=this.docScrollLeft();r-=this.docScrollTop()}return{x:n,y:r}},docScrollLeft:function(){if(window.pageXOffset)return window.pageXOffset;else if(document.documentElement&&document.documentElement.scrollLeft)return document.documentElement.scrollLeft;else if(document.body)return document.body.scrollLeft;else return 0},docScrollTop:function(){if(window.pageYOffset)return window.pageYOffset;else if(document.documentElement&&document.documentElement.scrollTop)return document.documentElement.scrollTop;else if(document.body)return document.body.scrollTop;else return 0}}